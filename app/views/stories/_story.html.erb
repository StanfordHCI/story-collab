<% 
  # Local variables used by this partial
  preview ||= false
%>

<div class="story"> 
  <h1>
    <%= @story.title %>
  </h1>

  <p class="subtitle">
    <%= @story.subtitle %>
  </p>

  <div class="meta">
    <div class="author">
      Started by <%= link_to @story.user.name, "#" %>
      <% if !preview %>
        <span class="timestamp">
          <%= time_ago_in_words(@story.created_at) %> ago
        </span>
      <% end %>
    </div>
  </div>

  <div class="editing">
    <% if !preview %>
      <%= link_to edit_story_path(@story), :class => "btn" do %>
      <i class="icon-edit"></i> Edit Story
      <% end %>
      <!--<%= link_to content_tag(:i, "", :class => "icon-plus-sign") + " New Question", "#", :class => "btn" %>-->
    <% end %>
  </div>

  <div class="content">
    <% parse_story(@story.content).each do |para| %>
    <div class="paragraph row-fluid">
      <div class="span7">
        <%= para[:para] %>
      </div>
      <div class="span1">
        10 <i class="icon-heart"></i>
      </div>
      <div class="span4">
        <%= para[:scene] %>
        <a class="btn btn-mini"><i class="icon-comment"></i> Respond</a>
      </div>
    </div>
    <% end %>
    <!-- temporary place for submitting inline answers -->
    <% @story.scenes.each do |scene| %>
      <div>Scene Title: <%= scene.title %></div>
      <% classes = "paragraph row-fluid" %>
      <% classes += " multiple" if scene.paragraphs.length > 1 %>
      <% classes += " unwritten" if scene.paragraphs.length < 1 %>
      <div class="<%= classes %>">
        <% if scene.paragraphs.length == 0 %>
          This part hasn't been written yet.
        <% elsif scene.paragraphs.length == 1 %>
          <%= scene.paragraphs.first.content %> 
        <% else %>
          <div class="next-paragraph"><i class="icon-caret-right"></i></div>
          <div class="prev-paragraph"><i class="icon-caret-left"></i></div>
          <% scene.paragraphs.each_with_index do |p, i| %>
            <div class="paragraph-inner <%= "hide" if i != 0 %>">
              <%= p.content %>
            </div>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>


<!-- <div class="storybar">
  <%= render 'question' %>
</div> -->
